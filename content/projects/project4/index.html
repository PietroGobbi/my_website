---
title: "index"
author: "Pietro Gobbi"
date: "10/20/2020"
output: html_document
---



<pre class="r"><code>library(tidyverse)  # Load ggplot2, dplyr, and all the other tidyverse packages</code></pre>
<pre><code>## ── Attaching packages ────────────────────────────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.2     ✓ purrr   0.3.4
## ✓ tibble  3.0.3     ✓ dplyr   1.0.2
## ✓ tidyr   1.1.2     ✓ stringr 1.4.0
## ✓ readr   1.4.0     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ───────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(mosaic)</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;mosaic&#39;:
##   method                           from   
##   fortify.SpatialPolygonsDataFrame ggplot2</code></pre>
<pre><code>## 
## The &#39;mosaic&#39; package masks several functions from core packages in order to add 
## additional features.  The original behavior of these functions should not be affected by this.</code></pre>
<pre><code>## 
## Attaching package: &#39;mosaic&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:Matrix&#39;:
## 
##     mean</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     count, do, tally</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     cross</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     stat</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     binom.test, cor, cor.test, cov, fivenum, IQR, median, prop.test,
##     quantile, sd, t.test, var</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     max, mean, min, prod, range, sample, sum</code></pre>
<pre class="r"><code>library(ggthemes)</code></pre>
<pre><code>## 
## Attaching package: &#39;ggthemes&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:mosaic&#39;:
## 
##     theme_map</code></pre>
<pre class="r"><code>library(GGally)</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;GGally&#39;:
##   method from   
##   +.gg   ggplot2</code></pre>
<pre class="r"><code>library(readxl) 
library(here)</code></pre>
<pre><code>## here() starts at /Users/tommaso/Desktop/my_websitePG</code></pre>
<pre class="r"><code>library(skimr)</code></pre>
<pre><code>## 
## Attaching package: &#39;skimr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:mosaic&#39;:
## 
##     n_missing</code></pre>
<pre class="r"><code>library(janitor)</code></pre>
<pre><code>## 
## Attaching package: &#39;janitor&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     chisq.test, fisher.test</code></pre>
<pre class="r"><code>library(broom)
library(tidyquant)</code></pre>
<pre><code>## Loading required package: lubridate</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<pre><code>## Loading required package: PerformanceAnalytics</code></pre>
<pre><code>## Loading required package: xts</code></pre>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre><code>## 
## Attaching package: &#39;xts&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     first, last</code></pre>
<pre><code>## 
## Attaching package: &#39;PerformanceAnalytics&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     legend</code></pre>
<pre><code>## Loading required package: quantmod</code></pre>
<pre><code>## Loading required package: TTR</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;quantmod&#39;:
##   method            from
##   as.zoo.data.frame zoo</code></pre>
<pre><code>## Version 0.4-0 included new data defaults. See ?getSymbols.</code></pre>
<pre><code>## ══ Need to Learn tidyquant? ═══════════════════════════════════════════════════════════════════════════
## Business Science offers a 1-hour course - Learning Lab #9: Performance Analysis &amp; Portfolio Optimization with tidyquant!
## &lt;/&gt; Learn more at: https://university.business-science.io/p/learning-labs-pro &lt;/&gt;</code></pre>
<pre class="r"><code>library(infer)</code></pre>
<pre><code>## 
## Attaching package: &#39;infer&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:mosaic&#39;:
## 
##     prop_test, t_test</code></pre>
<pre class="r"><code>library(openintro)</code></pre>
<pre><code>## Loading required package: airports</code></pre>
<pre><code>## Loading required package: cherryblossom</code></pre>
<pre><code>## Loading required package: usdata</code></pre>
<pre><code>## 
## Attaching package: &#39;openintro&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:mosaic&#39;:
## 
##     dotPlot</code></pre>
<pre><code>## The following objects are masked from &#39;package:lattice&#39;:
## 
##     ethanol, lsegments</code></pre>
<pre class="r"><code>library(tidyquant)
library(stringr)</code></pre>
<pre class="r"><code>big_post &lt;- read.csv(&quot;big_drop_post_2010_.csv&quot;)
medium_post &lt;- read.csv(&quot;medium_drop_post_2010_.csv&quot;)
small_post &lt;- read.csv(&quot;small_drop_post_2010_.csv&quot;)

big_pre &lt;- read.csv(&quot;big_drop_pre_2010_.csv&quot;)
medium_pre &lt;- read.csv(&quot;medium_drop_pre_2010_.csv&quot;)
small_pre &lt;- read.csv(&quot;small_drop_pre_2010_.csv&quot;)</code></pre>
<pre class="r"><code>## Data manipulation, cleaning and grouping
##POST
big_post &lt;- big_post %&gt;%
  mutate(type=&quot;BIG&quot;)
medium_post &lt;- medium_post %&gt;%
  mutate(type = &quot;MEDIUM&quot;)
small_post &lt;- small_post %&gt;%
  mutate(type=&quot;SMALL&quot;)

temp &lt;- big_post %&gt;%         ## counts number of entry for each Company and filters out Comp with number of entries not equal to a multiple of eight (errors due to data handling in previous file)
  group_by(Company)%&gt;%
  summarise(count = n())%&gt;%
  filter((count%%8)==0)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>big_post &lt;- big_post %&gt;%
  filter(Company %in% temp$Company)  #eliminate companies from main dataframe
big_post$days_drop = c(0:5,10,15)            #adds column with number of days from each drop in price

temp &lt;- medium_post %&gt;%        
  group_by(Company)%&gt;%
  summarise(count = n())%&gt;%
  filter((count%%8)==0)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>medium_post &lt;- medium_post %&gt;%
  filter(Company %in% temp$Company) 
medium_post$days_drop = c(0:5,10,15) 

temp &lt;- small_post %&gt;%        
  group_by(Company)%&gt;%
  summarise(count = n())%&gt;%
  filter((count%%8)==0)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>small_post &lt;- small_post %&gt;%
  filter(Company %in% temp$Company) 
small_post$days_drop = c(0:5,10,15) 
 
## PRE
big_pre &lt;- big_pre %&gt;%       #add type for future filtering and grouping
  mutate(type=&quot;BIG&quot;)
medium_pre &lt;- medium_pre %&gt;%
  mutate(type = &quot;MEDIUM&quot;)
small_pre &lt;- small_pre %&gt;%
  mutate(type=&quot;SMALL&quot;)

temp &lt;- big_pre %&gt;%         ## counts number of entry for each Company and filters out Comp with number of entries not equal to a multiple of eight (errors due to data handling in previous file)
  group_by(Company)%&gt;%
  summarise(count = n())%&gt;%
  filter((count%%8)==0)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>big_pre &lt;- big_pre %&gt;%
  filter(Company %in% temp$Company)  #eliminate companies from main dataframe
big_pre$days_drop = c(0:5,10,15) 

temp &lt;- medium_pre %&gt;%        
  group_by(Company)%&gt;%
  summarise(count = n())%&gt;%
  filter((count%%8)==0)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>medium_pre &lt;- medium_pre %&gt;%
  filter(Company %in% temp$Company) 
medium_pre$days_drop = c(0:5,10,15)

temp &lt;- small_pre %&gt;%        
  group_by(Company)%&gt;%
  summarise(count = n())%&gt;%
  filter((count%%8)==0)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>small_pre &lt;- small_pre %&gt;%
  filter(Company %in% temp$Company)  
small_pre$days_drop = c(0:5,10,15)

#from previous version: some dataframes have misplaced data imported from main data reading file, next chunk is going to clean it</code></pre>
<pre class="r"><code>&quot;%ni%&quot; &lt;- Negate(&quot;%in%&quot;)  #function needed to filter data

##POST
temp &lt;- big_post %&gt;%      #eliminates entries with a drop higher then -60% from the data frame
  filter(days_drop == 0 &amp; return &lt; -60)
big_post &lt;- big_post %&gt;%
  filter(Company %in% temp$Company)
check &lt;- big_post%&gt;%    #visually inspect to make sure drops are in the right interval
  filter(days_drop ==0)

temp &lt;- medium_post %&gt;%      #eliminates entries with a drop higher then -40% and lower than -60% 
  filter(days_drop == 0)
temp &lt;- temp %&gt;%
  filter(return &lt; -60 | return &gt; -40)
medium_post &lt;- medium_post %&gt;%
  filter(Company %ni% temp$Company)
check &lt;- medium_post%&gt;%    #visually inspect to make sure drops are in the right interval
  filter(days_drop ==0)

temp &lt;- small_post %&gt;%      #eliminates entries with a drop higher then -20% and lower than -40% 
  filter(days_drop == 0)
temp &lt;- temp %&gt;%
  filter(return &lt; -40 | return &gt; -20)
small_post &lt;- small_post %&gt;%
  filter(Company %ni% temp$Company)
check &lt;- small_post%&gt;%    #visually inspect to make sure drops are in the right interval
  filter(days_drop ==0)

## PRE
temp &lt;- big_pre %&gt;%      #eliminates entries with a drop higher then -60% from the data frame
  filter(days_drop == 0 &amp; return &lt; -60)
big_pre &lt;- big_pre %&gt;%
  filter(Company %in% temp$Company)
check &lt;- big_pre%&gt;%    #visually inspect to make sure drops are in the right interval
  filter(days_drop ==0)

temp &lt;- medium_pre %&gt;%      #eliminates entries with a drop higher then -40% and lower than -60% 
  filter(days_drop == 0)
temp &lt;- temp %&gt;%
  filter(return &lt; -60 | return &gt; -40)
medium_pre &lt;- medium_pre %&gt;%
  filter(Company %ni% temp$Company)
check &lt;- medium_pre%&gt;%    #visually inspect to make sure drops are in the right interval
  filter(days_drop ==0)

temp &lt;- small_pre %&gt;%      #eliminates entries with a drop higher then -20% and lower than -40% 
  filter(days_drop == 0)
temp &lt;- temp %&gt;%
  filter(return &lt; -40 | return &gt; -20)
small_pre &lt;- small_pre %&gt;%
  filter(Company %ni% temp$Company)
check &lt;- small_pre%&gt;%    #visually inspect to make sure drops are in the right interval
  filter(days_drop ==0)</code></pre>
<pre class="r"><code>#data grouping and adding relevant variables for analysis
#new variable to group based on price range
#new variable to track return from day of drop

post &lt;- rbind(big_post, medium_post, small_post)

post$price_range =NA 
 for(i in 1:length(post$price_range)){
   if(post$days_drop[i] ==0){
     if(post$Close[i]&lt;2){
       post$price_range[i]=&quot;Penny&quot;
       post$price_range[i+1]=&quot;Penny&quot;
       post$price_range[i+2]=&quot;Penny&quot;
       post$price_range[i+3]=&quot;Penny&quot;      #keep the same price range based on day of drop
       post$price_range[i+4]=&quot;Penny&quot;
       post$price_range[i+5]=&quot;Penny&quot;
       post$price_range[i+6]=&quot;Penny&quot;
       post$price_range[i+7]=&quot;Penny&quot;
     }
     if(post$Close[i]&gt;=2 &amp; post$Close[i]&lt;20){
       post$price_range[i]=&quot;2/20&quot;
       post$price_range[i+1]=&quot;2/20&quot;
       post$price_range[i+2]=&quot;2/20&quot;
       post$price_range[i+3]=&quot;2/20&quot;      #keep the same price range based on day of drop
       post$price_range[i+4]=&quot;2/20&quot;
       post$price_range[i+5]=&quot;2/20&quot;
       post$price_range[i+6]=&quot;2/20&quot;
       post$price_range[i+7]=&quot;2/20&quot;
     }
     if(post$Close[i]&gt;=20){
       post$price_range[i]=&quot;&gt;20&quot;
       post$price_range[i+1]=&quot;&gt;20&quot;
       post$price_range[i+2]=&quot;&gt;20&quot;
       post$price_range[i+3]=&quot;&gt;20&quot;      #keep the same price range based on day of drop
       post$price_range[i+4]=&quot;&gt;20&quot;
       post$price_range[i+5]=&quot;&gt;20&quot;
       post$price_range[i+6]=&quot;&gt;20&quot;
       post$price_range[i+7]=&quot;&gt;20&quot;
     }
   }
 }

pre &lt;- rbind(big_pre, medium_pre, small_pre)

pre$price_range =NA 
 for(i in 1:length(pre$price_range)){
   if(pre$days_drop[i] ==0){
     if(pre$Close[i]&lt;2){
       pre$price_range[i]=&quot;Penny&quot;
       pre$price_range[i+1]=&quot;Penny&quot;
       pre$price_range[i+2]=&quot;Penny&quot;
       pre$price_range[i+3]=&quot;Penny&quot;      #keep the same price range based on day of drop
       pre$price_range[i+4]=&quot;Penny&quot;
       pre$price_range[i+5]=&quot;Penny&quot;
       pre$price_range[i+6]=&quot;Penny&quot;
       pre$price_range[i+7]=&quot;Penny&quot;
     }
     if(pre$Close[i]&gt;=2 &amp; pre$Close[i]&lt;20){
       pre$price_range[i]=&quot;2/20&quot;
       pre$price_range[i+1]=&quot;2/20&quot;
       pre$price_range[i+2]=&quot;2/20&quot;
       pre$price_range[i+3]=&quot;2/20&quot;      #keep the same price range based on day of drop
       pre$price_range[i+4]=&quot;2/20&quot;
       pre$price_range[i+5]=&quot;2/20&quot;
       pre$price_range[i+6]=&quot;2/20&quot;
       pre$price_range[i+7]=&quot;2/20&quot;
     }
     if(pre$Close[i]&gt;=20){
       pre$price_range[i]=&quot;&gt;20&quot;
       pre$price_range[i+1]=&quot;&gt;20&quot;
       pre$price_range[i+2]=&quot;&gt;20&quot;
       pre$price_range[i+3]=&quot;&gt;20&quot;      #keep the same price range based on day of drop
       pre$price_range[i+4]=&quot;&gt;20&quot;
       pre$price_range[i+5]=&quot;&gt;20&quot;
       pre$price_range[i+6]=&quot;&gt;20&quot;
       pre$price_range[i+7]=&quot;&gt;20&quot;
     }
   }
 }

post &lt;- post %&gt;%
  mutate(return_from_drop = NA)

for (i in 1:length(post$return_from_drop)){
    if(post$days_drop[i]==0){post$return_from_drop[i] = 0}
    if(post$days_drop[i]==1){post$return_from_drop[i] = (post$Close[i]/post$Close[i-1]-1)*100}
    if(post$days_drop[i]==2){post$return_from_drop[i] = (post$Close[i]/post$Close[i-2]-1)*100}
    if(post$days_drop[i]==3){post$return_from_drop[i] = (post$Close[i]/post$Close[i-3]-1)*100}
    if(post$days_drop[i]==4){post$return_from_drop[i] = (post$Close[i]/post$Close[i-4]-1)*100}
    if(post$days_drop[i]==5){post$return_from_drop[i] = (post$Close[i]/post$Close[i-5]-1)*100}
    if(post$days_drop[i]==10){post$return_from_drop[i] = (post$Close[i]/post$Close[i-6]-1)*100}
    if(post$days_drop[i]==15){post$return_from_drop[i] = (post$Close[i]/post$Close[i-7]-1)*100}
}

pre &lt;- pre %&gt;%
  mutate(return_from_drop = NA)

for (i in 1:length(pre$return_from_drop)){
    if(pre$days_drop[i]==0){pre$return_from_drop[i] = 0}
    if(pre$days_drop[i]==1){pre$return_from_drop[i] = (pre$Close[i]/pre$Close[i-1]-1)*100}
    if(pre$days_drop[i]==2){pre$return_from_drop[i] = (pre$Close[i]/pre$Close[i-2]-1)*100}
    if(pre$days_drop[i]==3){pre$return_from_drop[i] = (pre$Close[i]/pre$Close[i-3]-1)*100}
    if(pre$days_drop[i]==4){pre$return_from_drop[i] = (pre$Close[i]/pre$Close[i-4]-1)*100}
    if(pre$days_drop[i]==5){pre$return_from_drop[i] = (pre$Close[i]/pre$Close[i-5]-1)*100}
    if(pre$days_drop[i]==10){pre$return_from_drop[i] = (pre$Close[i]/pre$Close[i-6]-1)*100}
    if(pre$days_drop[i]==15){pre$return_from_drop[i] = (pre$Close[i]/pre$Close[i-7]-1)*100}
}</code></pre>
<pre class="r"><code>#pivot wider 
#create ID variable to separate entries
post &lt;- post%&gt;%
  mutate(ID = NA)
k=0
for(i in 1:length(post$ID)){
    if(post$days_drop[i]==0){
      k=k+1
    }
  post$ID[i]=k
  
}

#now pivot wider in new dataframe
 
post_wider &lt;- post %&gt;%
  select(ID, Company, days_drop, Close, Open, return_from_drop, type, price_range)%&gt;%
  pivot_wider(!Company, names_from = days_drop , values_from = c(Close, Open, return_from_drop))

pre &lt;- pre%&gt;%
  mutate(ID = NA)
k=0
for(i in 1:length(pre$ID)){
    if(pre$days_drop[i]==0){
      k=k+1
    }
  pre$ID[i]=k
  
}

pre_wider &lt;- pre %&gt;%
  select(ID, Company, days_drop, Close, Open, return_from_drop, type, price_range)%&gt;%
  pivot_wider(!Company, names_from = days_drop , values_from = c(Close, Open, return_from_drop))</code></pre>
<pre class="r"><code>post_summary &lt;- post_wider %&gt;%  ## create 95% CIs for return from drop variable
  group_by(type,price_range)%&gt;%
  summarise(observation=n(),mean_01 = mean(return_from_drop_1), u01 = mean_01 + qnorm(.975)*sd(return_from_drop_1)/sqrt(observation), l01=mean_01 - qnorm(.975)*sd(return_from_drop_1)/sqrt(observation) , mean_02 = mean(return_from_drop_2), u02 = mean_02 + qnorm(.975)*sd(return_from_drop_2)/sqrt(observation), l02=mean_02 - qnorm(.975)*sd(return_from_drop_2)/sqrt(observation), mean_03 = mean(return_from_drop_3),u03 = mean_03 + qnorm(.975)*sd(return_from_drop_3)/sqrt(observation), l03=mean_03 - qnorm(.975)*sd(return_from_drop_3)/sqrt(observation),mean_04 = mean(return_from_drop_4),u04 = mean_04 + qnorm(.975)*sd(return_from_drop_4)/sqrt(observation), l04=mean_04 - qnorm(.975)*sd(return_from_drop_4)/sqrt(observation),mean_05 = mean(return_from_drop_5),u05 = mean_05 + qnorm(.975)*sd(return_from_drop_5)/sqrt(observation), l05=mean_05 - qnorm(.975)*sd(return_from_drop_5)/sqrt(observation),mean_10 = mean(return_from_drop_10),u10 = mean_10 + qnorm(.975)*sd(return_from_drop_10)/sqrt(observation), l10=mean_10 - qnorm(.975)*sd(return_from_drop_10)/sqrt(observation),mean_15= mean(return_from_drop_15,u15 = mean_15 + qnorm(.975)*sd(return_from_drop_15)/sqrt(observation), l15=mean_15 - qnorm(.975)*sd(return_from_drop_15)/sqrt(observation)))</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;type&#39; (override with `.groups` argument)</code></pre>
<pre class="r"><code>pre_summary &lt;- pre_wider %&gt;%
  group_by(type,price_range)%&gt;%
  summarise(observation=n(),mean_01 = mean(return_from_drop_1), u01 = mean_01 + qnorm(.975)*sd(return_from_drop_1)/sqrt(observation), l01=mean_01 - qnorm(.975)*sd(return_from_drop_1)/sqrt(observation) , mean_02 = mean(return_from_drop_2), u02 = mean_02 + qnorm(.975)*sd(return_from_drop_2)/sqrt(observation), l02=mean_02 - qnorm(.975)*sd(return_from_drop_2)/sqrt(observation), mean_03 = mean(return_from_drop_3),u03 = mean_03 + qnorm(.975)*sd(return_from_drop_3)/sqrt(observation), l03=mean_03 - qnorm(.975)*sd(return_from_drop_3)/sqrt(observation),mean_04 = mean(return_from_drop_4),u04 = mean_04 + qnorm(.975)*sd(return_from_drop_4)/sqrt(observation), l04=mean_04 - qnorm(.975)*sd(return_from_drop_4)/sqrt(observation),mean_05 = mean(return_from_drop_5),u05 = mean_05 + qnorm(.975)*sd(return_from_drop_5)/sqrt(observation), l05=mean_05 - qnorm(.975)*sd(return_from_drop_5)/sqrt(observation),mean_10 = mean(return_from_drop_10),u10 = mean_10 + qnorm(.975)*sd(return_from_drop_10)/sqrt(observation), l10=mean_10 - qnorm(.975)*sd(return_from_drop_10)/sqrt(observation),mean_15= mean(return_from_drop_15,u15 = mean_15 + qnorm(.975)*sd(return_from_drop_15)/sqrt(observation), l15=mean_15 - qnorm(.975)*sd(return_from_drop_15)/sqrt(observation)))</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;type&#39; (override with `.groups` argument)</code></pre>
<pre class="r"><code>graphpost &lt;- post_summary %&gt;%
   mutate(identifier = paste0(type,&quot; &quot;, price_range))%&gt;%
  ungroup()%&gt;%
  select(-observation, -type,-price_range)%&gt;%
pivot_longer(!identifier, names_to =&quot;STAT&quot;, values_to =&quot;Value&quot;)%&gt;%
  mutate(groupings = str_sub(STAT,1,1), days_drop = str_sub(STAT,-2,-1))

ggplot(graphpost, aes(x=days_drop, color=identifier, group =groupings))+
  geom_line(aes(y= Value))+
  geom_point(aes(y=Value))+
  facet_wrap(~identifier, scales = &quot;free&quot;)+
  labs(title = &quot;Mean returns from drop (Post 2010)&quot;, subtitle = &quot;Mean return, and 95% Confidence Interval lines&quot;, x=&quot;&quot;, y=&quot;%&quot;)+
  theme_bw()+
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" width="960" style="display: block; margin: auto;" /></p>
<pre class="r"><code>graphpre &lt;- pre_summary %&gt;%
   mutate(identifier = paste0(type,&quot; &quot;, price_range))%&gt;%
  ungroup()%&gt;%
  select(-observation, -type,-price_range)%&gt;%
pivot_longer(!identifier, names_to =&quot;STAT&quot;, values_to =&quot;Value&quot;)%&gt;%
  mutate(groupings = str_sub(STAT,1,1), days_drop = str_sub(STAT,-2,-1))

ggplot(graphpre, aes(x=days_drop, color=identifier, group =groupings))+
  geom_line(aes(y= Value))+
  geom_point(aes(y=Value))+
  facet_wrap(~identifier, scales = &quot;free&quot;)+
  labs(title = &quot;Mean returns from drop (Pre 2010)&quot;, subtitle = &quot;Mean return, and 95% Confidence Interval lines&quot;, x=&quot;&quot;, y=&quot;%&quot;)+
  theme_bw()+
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="960" style="display: block; margin: auto;" /></p>
